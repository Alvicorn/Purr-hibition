<!DOCTYPE html>
<html lang='en'>
<head>
	<title>Purr-hibition Portal</title>
	<meta charset="UTF-8">
	<link rel='stylesheet' href='/stylesheets/style.css'></link>
</head>

<body>
	<form>
		<h1>Purr-hibition Portal</h1>
		<h2>Live Video Feed</h2>
		<img id="videoFeed" src="" alt="Live Feed" style="max-width: 100%; height: auto;">

		<div id='content'>
			<div id='status-box'>
				<h2>Purrhibition's Status</h2>
				<div id='status'>None yet...</div>
			</div>

			<div id='left-box'>
				<div id='modediv'>
					<h3>Recording On/Off Selection</h3>
					<p>Currently recording is: <strong><span id="recordingId"></span></strong></p>
					<p>
						<input type="button" id="recordingOff" value="Off"/>
						<input type="button" id="recordingOn" value="On"/>
					</p>
					<h3>Deterrents On/Off Selection</h3>
					<p>Currently deterrents are: <strong><span id="deterrentsId"></span></strong></p>
					<p>
						<input type="button" id="deterrentsOff" value="Off"/>
						<input type="button" id="deterrentsOn" value="On"/>
					</p>
				</div>

				<div id='control'>
					<p>
						<input type="button" id="stop" value="Terminate Program"/>
					</p>
				</div>
			</div>
			<div id='error-box'>
				<h2>Server Error</h2>
				<p>Server error detected. Please resolve error before continuing.</p>
				<div><code id='error-text'>No error yet... did you hide this div correctly via Javascript? :)</code></div>
			</div>

			<!-- Video Player -->
			<h2>Available Videos</h2>

			<!-- Put the timestamp here so the user knows which video they are playing!! -->
			<p id="videoPlayerTimestamp"></p>
			<video id="videoPlayer" controls style="max-width: 100%; height: auto;">
				<source id="videoSource" src="" type="video/mp4" />
				Your browser does not support the video tag.
			</video>

			<table border="1">
				<thead>
					<tr>
						<th>Filename</th>
						<th>Timestamp</th>
						<th>Play</th>
					</tr>
				</thead>
				<tbody id="videoTableBody"></tbody>
			</table>

		</div>
	</form>

	<script src='/socket.io/socket.io.js' type='text/javascript'></script>
	<script src='http://code.jquery.com/jquery-1.11.1.min.js' type='text/javascript'></script>

	<script src='javascripts/purr-hibition_ui.js' type='text/javascript'></script>

	<!-- script for the video live stream -->
	<script>
		const ws = new WebSocket('ws://localhost:8080/live-feed');
        const imgElement = document.getElementById('videoFeed');

        ws.onopen = () => {
            console.log("WebSocket connected to video feed");
        };

        ws.onmessage = function(event) {
            const base64Image = event.data;
            imgElement.src = 'data:image/jpeg;base64,' + base64Image;
        };

        ws.onerror = function(error) {
            console.error("WebSocket Error: ", error);
        };
	</script>

</body>
</html>